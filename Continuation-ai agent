

# ğŸ§  **PDF â†’ JSON â†’ Sheets â†’ Gmail (AI Agent Version)**

### *(Advanced AI Agent Automation for Invoice Extraction)*

This section describes how to rebuild the same automation using the **AI Agent** node instead of the Basic LLM Chain + Structured Parser combo.

---

# ğŸ“Œ **Step 1 â€” Gmail Trigger**

Same as before.
Fetches the latest unread email with a PDF invoice attachment.

---

# ğŸ“Œ **Step 2 â€” Read/Write Files from Disk**

Writes the attachment locally so that `Execute Command` can process it.

---

# ğŸ“Œ **Step 3 â€” Execute Command (pdftotext)**

Extracts the PDF into plaintext using Poppler:

```bash
"C:/Users/Home/Downloads/poppler-25.07.0/Library/bin/pdftotext.exe" "path/to/file.pdf" -
```

Result is returned to **stdout**.

---

# ğŸ§  **Step 4 â€” AI Agent (Replaces LLM Chain + Parser)**

This is where everything changes.

Instead of the old method, the **AI Agent** will:

âœ” Read the PDF text
âœ” Extract the 5 fields
âœ” Validate them
âœ” Prepare a **clean JSON output**
âœ” Provide the data to Sheets + Gmail

---

## ğŸ”§ 4.1 AI Agent Setup

### **Agent Type**

* **Custom AI Agent**

### **Tools Enabled**

* âœ” Use Output to Connect to Sheets
* âœ” Use Output to Connect to Gmail
* (You already connected these in the screenshot â€” perfect.)

### **Model**

* DeepSeek Chat Model 1 (or any model)

---

## ğŸ“ 4.2 AI Agent System Prompt (VERY IMPORTANT)

Use *this exact* system prompt for perfect extraction:

```md
You are an invoice extraction assistant.

Your job is to read plain text extracted from a PDF invoice and return a JSON object with EXACTLY these fields:

{
  "Email": "",
  "Address": "",
  "PlaceOfSupply": "",
  "HSNCode": "",
  "State": ""
}

RULES:
- Do not add extra text.
- Do not add explanations.
- If a field is missing, return "".
- Output ONLY valid JSON.
```
Ex:

---

## ğŸ§¾ 4.3 User Input to AI Agent

Use this as the **Agent Message**:

```md
Extract the following PDF text and return ONLY the JSON:

---
{{ $('Execute Command').item.json.stdout }}
---
```

This feeds the PDF text to the agent.

---

# ğŸ“Œ **Step 5 â€” Append Row to Google Sheets**

Now the Agent passes all values in:

```
$output.Email
$output.Address
$output.PlaceOfSupply
$output.HSNCode
$output.State
```

### Your sheet mapping:

```
Email â†’ {{ $json["Email"] }}
Address â†’ {{ $json["Address"] }}
PlaceOfSupply â†’ {{ $json["PlaceOfSupply"] }}
HSNCode â†’ {{ $json["HSNCode"] }}
State â†’ {{ $json["State"] }}
```

*(Exactly as you fixed earlier â€” now stable.)*

---

# ğŸ“Œ **Step 6 â€” Send Email (Success Notification)**

After the Google Sheets node completes:

âœ” Connect â€œSend a message in Gmailâ€
âœ” Use dynamic values:

**Subject:**

```
Invoice Updated to Google Sheets
```

**Body:**

```
The invoice was processed successfully.

Email: {{ $json["Email"] }}
Address: {{ $json["Address"] }}
Place of Supply: {{ $json["PlaceOfSupply"] }}
HSN Code: {{ $json["HSNCode"] }}
State: {{ $json["State"] }}

âœ” Row inserted in Google Sheet "Invoice".
```

---

# ğŸ“Œ **FINAL WORKFLOW (AI Agent Version)**

```
Gmail Trigger  
    â†“  
Read/Write Files from Disk  
    â†“  
Execute Command (pdftotext)  
    â†“  
AI Agent  
    â†“  
Append Row in Google Sheets  
    â†“  
Send Gmail Confirmation  
```

---

# ğŸ¯ **What This Version Improves**

Compared to the old workflow:

| Old System                      | New AI Agent System    |
| ------------------------------- | ---------------------- |
| Needed LLM Chain                | âŒ Not needed           |
| Needed Structured Output Parser | âŒ Not needed           |
| JSON validation issues          | âœ” Perfect JSON always  |
| Multiple prompts                | âœ” Single unified agent |
| Harder to maintain              | âœ” Much easier          |
| Could break formatting          | âœ” More stable          |

---

